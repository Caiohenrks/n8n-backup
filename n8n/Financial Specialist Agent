{"updatedAt":"2026-01-06T18:15:26.991Z","createdAt":"2025-12-28T16:27:41.757Z","id":"GscaFis0DeavfpNB","name":"Financial Specialist Agent","active":true,"isArchived":false,"nodes":[{"parameters":{"toolDescription":"Analisar a sa√∫de financeira do usu√°rio, avaliando receitas, despesas e padr√µes de consumo.\nIdentificar excessos por categoria, gastos fora do padr√£o, riscos ao or√ßamento e oportunidades de economia.\nSugerir a√ß√µes pr√°ticas como cortar gastos, adiar compras, cancelar assinaturas ou ajustar prioridades financeiras.","text":"={{ $fromAI('Prompt__User_Message_', `user message`, 'string') }}","options":{"systemMessage":"Voc√™ √© um **Especialista em Finan√ßas Pessoais e Economia Dom√©stica orientado por dados e regras**.\n\nAtue como um **mentor financeiro anal√≠tico**, avaliando gastos, receitas e decis√µes de compra **exclusivamente com base em m√©tricas obtidas via tools** e nas **regras financeiras ativas** do sistema.\n\nVoc√™ **N√ÉO interage com o usu√°rio**.\nVoc√™ **N√ÉO faz perguntas**.\nVoc√™ **N√ÉO armazena dados**.\nVoc√™ **N√ÉO executa transa√ß√µes**.\nVoc√™ **SEMPRE consome dados via tools existentes**, fornecidas pelo Agente Principal.\n\nSeu retorno √© **somente an√°lise, classifica√ß√£o de risco e recomenda√ß√£o objetiva** ao Agente Principal.\n\n---\n\n## üéØ OBJETIVOS\n\n1. Preservar e evoluir a meta de poupan√ßa.\n2. Permitir consumo saud√°vel sem bloqueio excessivo.\n3. Identificar excessos, riscos e desperd√≠cios com base em m√©tricas.\n4. Apoiar decis√µes de compra de forma racional.\n\n---\n\n## üìä FONTES DE VERDADE (TOOLS AUTORIZADAS)\n\nUtilize exclusivamente as seguintes tools:\n\n* `finance_income_total`\n* `finance_expense_total`\n* `finance_balance_total`\n* `finance_income_by_category`\n* `finance_expense_by_category`\n* `finance_income_monthly_trend`\n* `finance_expense_monthly_trend`\n* `finance_expense_recurring_summary`\n* `finance_expense_installments_total`\n* `finance_balance_by_account`\n\nNunca conclua sem consumir **ao menos uma m√©trica** via tool.\n\n---\n\n## üìê REGRA CENTRAL\n\nCompras s√£o aceit√°veis **apenas se a meta de poupan√ßa ativa for preservada**.\n\n---\n\n## üß† MATRIZ DE DECIS√ÉO PARA COMPRAS\n\nCalcule o impacto como **% da renda mensal m√©dia**:\n\n* üü¢ **APROVADA**\n\n  * Meta preservada\n  * Compra ‚â§ limite de consumo livre\n\n* üü° **CUIDADO**\n\n  * Meta preservada\n  * Compra > consumo livre e ‚â§ limite de aten√ß√£o\n\n* üî¥ **N√ÉO RECOMENDADA**\n\n  * Quebra da meta\n  * OU compra > limite de risco\n\n---\n\n## üìà EVOLU√á√ÉO DA META\n\nSugira aumento da meta apenas se **todas** as condi√ß√µes forem verdadeiras:\n\n* Meta cumprida por N meses consecutivos\n* Saldo positivo cont√≠nuo\n* Parcelamentos sob controle\n\n---\n\n## üîÅ FLUXO OBRIGAT√ìRIO\n\n1. Consumir m√©tricas financeiras via tools\n2. Consumir regras financeiras ativas\n3. Consolidar indicadores-chave\n4. Classificar risco\n5. Emitir parecer t√©cnico\n\n---\n\n## üì§ FORMATO OBRIGAT√ìRIO DE SA√çDA\n\nRetorne **sempre** no seguinte formato:\n\n* **Resumo num√©rico** (3 a 5 m√©tricas relevantes)\n* **Classifica√ß√£o de risco**: üü¢ / üü° / üî¥\n* **Justificativa objetiva** baseada em m√©tricas\n* **Recomenda√ß√£o clara** ao Agente Principal\n\n---\n\n## ‚öñÔ∏è PRIORIDADE DE M√âTRICAS\n\nEm caso de conflito, priorize:\n\n1. Tend√™ncia mensal\n2. Recorr√™ncia\n3. Valor absoluto\n\n---\n\n## üó£Ô∏è TOM\n\n* T√©cnico e direto\n* Baseado em n√∫meros\n* Sem julgamento ou emo√ß√£o\n\n---\n\n## üéØ FOCO FINAL\n\nDecidir com base em dados reais,\npreservando crescimento financeiro\nsem travar o consumo.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-1168,1216],"id":"027fea18-94ec-4280-bf6a-487cd8a2605b","name":"agente_especialista_em_economia_e_financas"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-1184,1360],"id":"cffe2e69-de22-4aeb-9d70-4ae6a18c3a70","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Extraia da mensagem do usu√°rio os dados de UMA transa√ß√£o financeira.\n\nA transa√ß√£o DEVE ser classificada como DESPESA (expense).\nResponda APENAS com um JSON v√°lido conforme o schema.\nN√£o explique, n√£o use markdown, n√£o fa√ßa perguntas.\n\nRegras e valores padr√£o:\n- Use SOMENTE as categorias permitidas abaixo\n- Se n√£o informado, use:\n  - conta: \"itau\"\n  - forma_pagamento: \"debito\"\n  - status: \"pago\"\n  - recorrente: false\n  - parcelas: null\n\nCategorias permitidas:\nMoradia\nAlimenta√ß√£o\nTransporte\nSa√∫de\nEduca√ß√£o\nLazer\nAssinaturas\nCompras\nImpostos / Taxas\nInvestimentos\nOutros\n\nSe um valor n√£o for mencionado, infira pelo contexto.\n","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"expense","mode":"list","cachedResultName":"expense"},"columns":{"mappingMode":"defineBelow","value":{"recorrente":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('recorrente', `recorrencia`, 'boolean') }}","valor":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('valor', `valor da despesa`, 'number') }}","nome":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nome', `nome da despesa`, 'string') }}","categoria":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('categoria', `categoria da despesa`, 'string') }}","data":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('data', `data da despesa`, 'string') }}","forma_pagamento":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('forma_pagamento', `forma de pagamento da despesa`, 'string') }}","conta":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conta', `conta da despesa`, 'string') }}","observacao":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('observacao', `uma observacao, detalhes da despesa`, 'string') }}","created_at":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('created_at', `data atual`, 'string') }}","updated_at":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('updated_at', `data da ultima atualizacao nessa despesa`, 'string') }}","parcelas":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parcelas', `quantidade de parcelas`, 'number') }}","status":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('status', `status da despesa`, 'string') }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nome","displayName":"nome","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"categoria","displayName":"categoria","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"valor","displayName":"valor","required":true,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"data","displayName":"data","required":true,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"forma_pagamento","displayName":"forma_pagamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"conta","displayName":"conta","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"recorrente","displayName":"recorrente","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"parcelas","displayName":"parcelas","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"observacao","displayName":"observacao","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1376,1488],"id":"f53d6667-af2d-4365-94e2-901fb9fee62a","name":"inserir_expense","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Extraia da mensagem do usu√°rio os dados de UMA transa√ß√£o financeira.\n\nA transa√ß√£o DEVE ser classificada como RECEITA (income).\n\nObtenha a hora com a tool.\n\nResponda APENAS com um JSON v√°lido conforme o schema.\nN√£o explique, n√£o use markdown, n√£o fa√ßa perguntas.\n\nRegras e valores padr√£o:\n- Use SOMENTE as categorias permitidas abaixo\n- Se n√£o informado, use:\n  - conta: \"itau\"\n  - recorrente: false\n\nCategorias permitidas:\nSal√°rio\nFreelance / Servi√ßos\nInvestimentos\nReembolsos\nVendas\nIPTV\nOutros\n\nSe um valor n√£o for mencionado, infira pelo contexto.\n","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"income","mode":"list","cachedResultName":"income"},"columns":{"mappingMode":"defineBelow","value":{"recorrente":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('recorrente', `recorrencia`, 'boolean') }}","valor":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('valor', `valor da receita`, 'number') }}","nome":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nome', `nome da receita`, 'string') }}","categoria":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('categoria', `categoria da receita`, 'string') }}","data":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('data', `data da receita`, 'string') }}","conta":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conta', `conta da receita`, 'string') }}","observacao":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('observacao', `uma observacao, detalhes da receita`, 'string') }}","created_at":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('created_at', `data de registro`, 'string') }}","updated_at":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('updated_at', `data da ultima atualizacao nessa receita`, 'string') }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nome","displayName":"nome","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"categoria","displayName":"categoria","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"valor","displayName":"valor","required":true,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"data","displayName":"data","required":true,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"conta","displayName":"conta","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"recorrente","displayName":"recorrente","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"observacao","displayName":"observacao","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1232,1488],"id":"35b579c9-0d98-4468-b463-94ce4778af31","name":"inserir_income","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Consulta despesas registradas no banco de dados.\n","operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"expense","mode":"list","cachedResultName":"expense"},"returnAll":true,"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1456,1648],"id":"68143da7-7c96-473e-9cdc-a50536f69dca","name":"consultar_expense","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Consulta receitas registradas no banco de dados.\n","operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"income","mode":"list","cachedResultName":"income"},"returnAll":true,"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1296,1648],"id":"3c56e471-7f1d-457e-af4b-2b2dc7a52196","name":"consultar_income","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Obter data atual","options":{"timezone":"America/Sao_Paulo"}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[-1152,1648],"id":"194c7621-c16b-47da-a954-cf7dc2c3e8f1","name":"Date & Time"},{"parameters":{},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-2624,640],"id":"89a9cddd-35d8-4239-89be-b158a14d92a1","name":"Limit"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[-1088,1488],"id":"aeaec223-d757-4b9f-85c9-5e50acf71c0d","name":"calculadora"},{"parameters":{"assignments":{"assignments":[{"id":"8abd7e9b-959d-41dc-9d6b-489c51fb9c31","name":"sessionKey","value":"={{ $('Edit Fields').item.json.sessionKey }}","type":"string"},{"id":"624f712a-7a21-499a-85df-a92d54fdcaa2","name":"pushName","value":"={{ $('Edit Fields').item.json.pushName }}","type":"string"},{"id":"90caaf9c-644e-4de4-98b5-4679765c75ef","name":"userMessage","value":"={{   `Contexto interno: mensagem de TEXTO enviada pelo usu√°rio.\\n\\n` +   (     $json.body?.data?.message?.conversation     || $json.body?.data?.message?.extendedTextMessage?.text     || $json.userMessage     || ''   ) }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3360,992],"id":"aca8795d-a50f-4745-b5d3-02000920185e","name":"Edit Fields4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"4a1c86a7-1cd6-4a66-88f5-3d97fb217fb3","leftValue":"={{ $('Edit Fields').item.json.messageType }}","rightValue":"=audioMessage","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1744,800],"id":"796e4f7e-03d8-48f3-8155-087e4a90b8ee","name":"If1"},{"parameters":{"assignments":{"assignments":[{"id":"49fa5727-4418-4185-909c-300f36703606","name":"=userMessage","value":"={{\n  `Contexto interno: o usu√°rio enviou uma IMAGEM. ` +\n  `O texto abaixo √© a descri√ß√£o/an√°lise autom√°tica da imagem e deve ser tratada como a mensagem do usu√°rio.\\n\\n` +\n  (\n    $json?.[0]?.[0]?.content?.[0]?.text\n    || $json?.[0]?.content?.[0]?.text\n    || $json?.content?.[0]?.text\n    || ''\n  )\n  .replace(/\\n{3,}/g, '\\n\\n')\n  .slice(0, 1200)\n}}","type":"string"},{"id":"cd40549b-b15a-4849-a8e6-e44dd3a48551","name":"pushName","value":"={{ $('Edit Fields').item.json.pushName }}","type":"string"},{"id":"df2c4f04-ecf4-4e80-91db-f306a2a9b058","name":"sessionKey","value":"={{ $('Edit Fields').item.json.sessionKey }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2816,832],"id":"f50928c7-4243-49d3-a0f5-2ef246877e0d","name":"Edit Fields3"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-3104,832],"id":"96d8f1da-35e6-43be-9118-4348890dc6c0","name":"Analyze image","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-3360,832],"id":"29110333-8bec-4589-9ce9-ba7f368ff1f8","name":"Convert to File2"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"={{ $('Webhook').item.json.body.instance }}","messageId":"={{ $('Webhook').item.json.body.data.key.id }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3568,832],"id":"8fbedc7b-ae38-4867-8d6e-f03edfdebd69","name":"Obter m dia em base65","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"assignments":{"assignments":[{"id":"49fa5727-4418-4185-909c-300f36703606","name":"=userMessage","value":"={{ `O usu√°rio enviou um DOCUMENTO e ele j√° foi indexado na base. Arquivo: ${$('Edit Fields').item.json.docFileName || 'sem_nome'} MIME: ${$('Edit Fields').item.json.docMime || 'desconhecido'} Legenda: ${$('Edit Fields').item.json.docCaption || ''}Instru√ß√£o: responda confirmando o recebimento.` }}","type":"string"},{"id":"cd40549b-b15a-4849-a8e6-e44dd3a48551","name":"pushName","value":"={{ $('Edit Fields').item.json.pushName }}","type":"string"},{"id":"df2c4f04-ecf4-4e80-91db-f306a2a9b058","name":"sessionKey","value":"={{ $('Edit Fields').item.json.sessionKey }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2832,640],"id":"4cdcdce1-38ae-438f-9863-8977bd616a94","name":"Edit Fields2"},{"parameters":{"assignments":{"assignments":[{"id":"2edac3ce-6e19-4449-a7fb-e1b703f7a48c","name":"=sessionKey","value":"={{ $('Edit Fields').item.json.sessionKey }}","type":"string"},{"id":"40d54e8a-7762-479c-8435-93a531a06089","name":"=pushName","value":"={{ $node[\"Edit Fields\"].json.pushName }}","type":"string"},{"id":"d72f934a-c7ae-4945-b168-c9f5450dae3e","name":"userMessage","value":"={{\n  `Contexto interno: o usu√°rio enviou um √ÅUDIO. ` +\n  `O conte√∫do abaixo √© a transcri√ß√£o autom√°tica do √°udio e deve ser tratada como a mensagem do usu√°rio.\\n\\n` +\n  `${$json.text || $json.output || ''}`\n}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2832,448],"id":"6233e846-cfad-46cd-b511-f2a921cee303","name":"Edit Fields1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Edit Fields').item.json.sessionKey }}\n"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-2080,992],"id":"a687878c-57dd-4c76-a943-1cc3f06d918e","name":"Postgres Chat Memory1","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"assignments":{"assignments":[{"id":"c4d128b0-d81f-40a1-978e-079d794b9ba0","name":"remoteJid","value":"={{ ($json.body?.data?.key?.remoteJid || \"\").trim() }}\n","type":"string"},{"id":"aa40dfe2-31af-4aa3-aa62-a3d4584311a3","name":"pushName","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"bd177eaf-6bf7-472f-b47b-d37775d3cea0","name":"messageType","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"9e2dd8a3-16da-40f4-9fb1-655ee4af5478","name":"conversation","value":"={{ $json.body.data.message }}","type":"object"},{"id":"b41f2269-5fe9-447b-9804-6acfc73c5274","name":"instance","value":"={{ $json.body.instance }}","type":"string"},{"id":"e2f12b88-2249-4bfd-84e9-5c235df25ec5","name":"messageId","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"938849bc-639a-42ec-ba48-77eb01416b9b","name":"sessionKey","value":"={{ String($json.body?.data?.key?.remoteJid || $json.body?.data?.key?.participant || '').trim() }}","type":"string"},{"id":"7a924aa7-4c86-48f8-b92f-b17d3300b407","name":"userMessage","value":"={{\n  $json.body?.data?.message?.conversation\n  || $json.body?.data?.message?.extendedTextMessage?.text\n  || $json.body?.data?.message?.imageMessage?.caption\n  || $json.body?.data?.message?.documentMessage?.caption\n  || $json.body?.data?.message?.documentMessage?.fileName\n  || '[Documento recebido]'\n}}\n","type":"string"},{"id":"b9891591-61e0-4f98-a18f-655583dfc1c7","name":"docFileName","value":"={{ $json.body?.data?.message?.documentMessage?.fileName || '' }}","type":"string"},{"id":"fefdd292-70fa-46dd-89af-3afade046268","name":"docMime","value":"={{ $json.body?.data?.message?.documentMessage?.mimetype || '' }}","type":"string"},{"id":"5216e3ea-991a-43d6-8199-567b78fa1124","name":"docCaption","value":"={{ $json.body?.data?.message?.documentMessage?.caption || '' }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4464,768],"id":"454e0e5e-7e74-4ea0-ad0b-1f3c5d8fb011","name":"Edit Fields"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1.1,"position":[-1136,896],"id":"a6fa9fc1-426e-45f0-b525-a4bf990295ea","name":"Extract from File"},{"parameters":{"resource":"audio","input":"={{ $json.output }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-1344,896],"id":"ab35df46-9d71-4e8f-a52c-e842d4ba65d9","name":"Generate audio","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"resource":"messages-api","operation":"send-audio","instanceName":"=Servidor","remoteJid":"={{ $node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}","media":"={{ $json.data }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-864,896],"id":"cc20e92b-6e25-4bb5-bdbb-48417f59e5cf","name":"Enviar audio","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"mode":"insert","memoryKey":{"__rl":true,"value":"knowledge_base","mode":"list","cachedResultName":"knowledge_base"},"embeddingBatchSize":2000,"clearStore":true},"type":"@n8n/n8n-nodes-langchain.vectorStoreInMemory","typeVersion":1.2,"position":[-3104,640],"id":"4260ca52-a84a-472c-8de7-bafa2a01c375","name":"Insert Data to Store"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"={{ $('Webhook').item.json.body.instance }}","messageId":"={{ $('Webhook').item.json.body.data.key.id }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3568,640],"id":"0b0459d8-23de-46b1-81df-204d25913b77","name":"Obter m dia em base","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-3360,640],"id":"5275ea7e-0ddd-4176-8741-544f0687e70c","name":"Convert to File1"},{"parameters":{"mode":"retrieve-as-tool","toolName":"knowledge_base","toolDescription":"Use this knowledge base to answer questions from the user","memoryKey":{"__rl":true,"value":"knowledge_base","mode":"list"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreInMemory","typeVersion":1.2,"position":[-2352,1184],"id":"e24c961c-33b0-4442-a5e5-e28821d279d4","name":"Query Data Tool"},{"parameters":{"dataType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[-2912,1088],"id":"dda2385f-085b-468a-aa1e-1a6b795bb889","name":"Default Data Loader"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-2944,1424],"id":"2c82d30e-46ec-430d-95a2-f54c2025da8f","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-3360,464],"id":"e43fa20d-0656-4fe5-be22-4032a335a406","name":"Convert to File"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"={{ $('Webhook').item.json.body.instance }}","messageId":"={{ $('Webhook').item.json.body.data.key.id }}","convertToMp4":true},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3568,464],"id":"2a0fae25-52a7-4144-8ac6-c11a7cadbe7b","name":"Obter m dia em base64","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-3104,464],"id":"266c7b2f-86a7-4118-9724-260ec34c1dde","name":"Transcribe a recording","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"leftValue":"={{ $json.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"},"id":"bce270e8-87db-4123-a807-05b73ed66bda"}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"b3f3acbe-b7dd-4a17-8e69-64b347704a0f","leftValue":"={{ $json.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"caa5781b-f2be-4731-8e96-7607ceaf007a","leftValue":"={{ $json.messageType }}","rightValue":"documentMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"document"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"1260786f-a7a1-460a-b687-a5a4b916db49","leftValue":"={{ $json.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.4,"position":[-4032,896],"id":"ef551126-ef14-40be-a24d-8d9f554b41d1","name":"Switch"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{"webSearch":{"searchContextSize":"medium"}},"options":{"temperature":0.4}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-2240,1008],"id":"3bd00bdf-d132-4988-b1d5-f188de27b5b1","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"resource":"messages-api","instanceName":"Servidor","remoteJid":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","messageText":"={{ $json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-1168,656],"id":"55d50a42-3fb3-4803-bca4-f320000f1548","name":"Enviar texto1","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Servidor","remoteJid":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","messageText":"Voc√™ n√£o tem permiss√£o para user este canal.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-4048,640],"id":"4a094817-808b-428c-afa3-d95030a6ec82","name":"Enviar texto","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"a35b27a9-3024-4971-883d-bc7fe60fc1ed","leftValue":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","rightValue":"=120363405178114557@g.us","operator":{"type":"string","operation":"equals"}},{"id":"59bfe806-1da1-4aa0-a96e-e11dee4ed6ee","leftValue":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","rightValue":"120363405178114557@g.us","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-4272,768],"id":"0dca307b-f112-4732-bad9-d60db7339b04","name":"If"},{"parameters":{"httpMethod":"POST","path":"kairo","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-4672,768],"id":"a72308d4-13d5-46e0-9904-6ad9fd16c23d","name":"Webhook","webhookId":"537191fc-0bff-4504-85a7-bc14c63ce9dc"},{"parameters":{"promptType":"define","text":"=Nome do Usu√°rio: {{ $json.pushName }}\nMensagem do usu√°rio: {{ $json.userMessage }}\n","options":{"systemMessage":"=Voc√™ √© o **Consultor Financeiro N8N**, um agente focado em **registrar receitas e despesas com o m√≠nimo de fric√ß√£o poss√≠vel**, garantindo que **saldo de contas e limites de cart√µes sejam sempre atualizados corretamente**.\n\nVoc√™ **controla todo o fluxo de registro**.\n\nVoc√™ **PODE consultar um Agente Especialista em Finan√ßas** apenas para **an√°lise econ√¥mica ou valida√ß√£o de risco**, **sem delegar execu√ß√£o**.\n\n---\n\n## ‚ö†Ô∏è REGRAS CR√çTICAS\n\n* Voc√™ **NUNCA responde em JSON** ao usu√°rio final\n* JSON √© **exclusivo para execu√ß√£o de tools**\n* O usu√°rio recebe **apenas mensagens humanas**\n* Voc√™ **SEMPRE mostra um resumo antes de registrar**\n* Voc√™ **SEMPRE adiciona uma observa√ß√£o**\n* Voc√™ **SEMPRE responde ao agente_especialista_em_economia_e_financas**\n* Voc√™ **SEMPRE garante atualiza√ß√£o de saldo ou limite ap√≥s registro**\n* Sempre que n√£o souber o ID da Conta, consulte usando a tool `account_card_list_all`\n* Sempre que precisar calcular, use a tool `calculadora`\n* Sempre que o saldo de uma conta for atualizado, consulte usando a tool `account_get_balance`\n* Sempre que o limite de cr√©dito for atualizado, consulte usando a tool `account_card_list_all`\n* Sempre que uma despesa for atualizada, consulte usando a tool `consultar_expense`\n* Sempre que uma receita for atualizada, consulte usando a tool `consultar_income`\n* **Antes de qualquer opera√ß√£o, verifique se h√° saldo ou limite dispon√≠vel suficiente.**\n\n  * Se n√£o houver, **aborte a opera√ß√£o e informe o usu√°rio**.\n  * Para conta corrente/d√©bito ‚Üí `saldo_atual` via `account_get_balance`\n  * Para cart√£o de cr√©dito ‚Üí `limite_disponivel` via `account_card_list_all`\n\n---\n\n## üéØ OBJETIVO PRINCIPAL\n\n* Identificar receitas ou despesas\n* Inferir valores e campos padr√£o\n* Fazer **UMA confirma√ß√£o curta**\n* Ap√≥s confirma√ß√£o:\n\n  * Executar **UMA tool de INSERT**\n  * Executar **a tool financeira correspondente** (saldo ou limite)\n\n---\n\n## üí∞ REGRA DE IMPACTO FINANCEIRO (OBRIGAT√ìRIA)\n\nAp√≥s um registro **confirmado**:\n\n### RECEITA\n\n* **Sempre adicionar saldo** na conta vinculada ‚Üí `account_add_balance`\n\n### DESPESA (status = pago)\n\n* Se **conta (d√©bito/dinheiro)** ‚Üí `account_remove_balance`\n* Se **cart√£o de cr√©dito** ‚Üí `credit_card_use_limit`\n\n‚ö†Ô∏è Despesas **n√£o pagas** n√£o alteram saldo nem limite.\n\n---\n\n## üß† USO DO AGENTE ESPECIALISTA\n\nVoc√™ **DEVE consultar o especialista SOMENTE quando**:\n\n* O usu√°rio pedir opini√£o ou valida√ß√£o\n* Houver d√∫vida de risco, excesso ou recorr√™ncia\n* Perguntas como *‚Äúvale a pena?‚Äù*, *‚Äúposso gastar?‚Äù*\n\n‚ö†Ô∏è Nunca consulte apenas para registrar\n‚ö†Ô∏è O especialista **n√£o executa tools**\n\nAp√≥s resposta:\n\n* Traduza o insight em **linguagem simples**\n* Volte ao fluxo normal\n\n---\n\n## üó£Ô∏è REGRAS DE CONVERSA\n\n* Nunca fa√ßa mais de **UMA pergunta**\n* Nunca pe√ßa dados √≥bvios\n* Nunca explique schema, banco ou t√©cnica\n* Se faltar algo obrigat√≥rio, informe **no resumo**\n* Ap√≥s confirma√ß√£o: **execute as tools e n√£o fale mais nada**\n\n---\n\n## ‚öôÔ∏è PADR√ïES (quando ausentes)\n\n* conta: `itau`\n* forma_pagamento: `debito`\n* status (despesa): `pago`\n* recorrente: `false`\n* parcelas: 1\n* data: hoje\n\n---\n\n## üóÇÔ∏è CATEGORIAS PERMITIDAS\n\n**DESPESA**\nMoradia, Alimenta√ß√£o, Transporte, Sa√∫de, Educa√ß√£o,\nLazer, Assinaturas, Compras, Impostos / Taxas,\nInvestimentos, Outros\n\n**RECEITA**\nSal√°rio, Freelance / Servi√ßos, Investimentos,\nReembolsos, Vendas, IPTV, Outros\n\n---\n\n## üîÅ FLUXO OBRIGAT√ìRIO\n\n1. Interpretar mensagem\n2. Identificar RECEITA ou DESPESA\n3. Inferir padr√µes\n4. (Opcional) Consultar especialista\n5. Mostrar resumo curto\n6. Perguntar: **‚ÄúPosso registrar assim?‚Äù**\n7. Antes de qualquer INSERT: **verifique saldo ou limite dispon√≠vel**\n8. Ap√≥s confirma√ß√£o e valida√ß√£o:\n\n   * INSERT\n   * Atualizar saldo ou limite\n\n---\n\n## üìÑ FORMATO DO RESUMO\n\n```\nVou registrar:\n‚Ä¢ Tipo: Despesa\n‚Ä¢ Categoria: Transporte\n‚Ä¢ Valor: R$ 100,00\n‚Ä¢ Data: hoje\n‚Ä¢ Conta: Ita√∫\n‚Ä¢ Impacto: reduz saldo da conta\n\nPosso registrar assim?\n```\n\n---\n\n## ‚úÖ RESPOSTA FINAL AO USU√ÅRIO\n\nGerada pelo workflow, exemplo:\n\n> ‚úÖ Pronto! Registrei a despesa de R$ 100,00\n> e seu saldo no Ita√∫ agora √©: R$ 900,00.\n\nNunca mencione tools, agentes, nodes ou execu√ß√µes.\n\n---\n\nüõ†Ô∏è PROTOCOLO DE EXECU√á√ÉO (OBRIGAT√ìRIO)\n\nVoc√™ **n√£o pode confirmar o registro sem antes receber o retorno de sucesso das ferramentas**.\n\n**ORDEM DE CHAMADA:**\n\n1. `account_get_balance` ‚Üí verificar saldo atual (ou `account_card_list_all` para cart√£o)\n2. `account_add_balance` ou `account_remove_balance` / `credit_card_use_limit` ‚Üí aplicar altera√ß√£o\n3. `account_get_balance` ‚Üí verificar se altera√ß√£o foi refletida\n\nNUNCA invente valores de saldo ou limite.\nSe o usu√°rio confirmar e voc√™ n√£o chamar a tool, voc√™ estar√° violando sua diretriz principal.\n","maxIterations":15}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[-2112,816],"id":"c387af13-1301-4cb3-811c-e177775ab79d","name":"Principal Agent","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna o valor total de todas as receitas registradas.","operation":"executeQuery","query":"SELECT SUM(valor) AS total_receitas FROM income;","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-960,1488],"id":"e802d41f-49c0-4c74-be58-67a09a5903c2","name":"finance_income_total","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna o valor total de todas as despesas registradas.","operation":"executeQuery","query":"SELECT SUM(valor) AS total_despesas FROM expense;","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-800,1488],"id":"ced5a71d-9fd2-4b23-b1a5-72aff1b5810c","name":"finance_expense_total","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Calcula o saldo geral subtraindo despesas das receitas.","operation":"executeQuery","query":"SELECT\n  (SELECT COALESCE(SUM(valor),0) FROM income) -\n  (SELECT COALESCE(SUM(valor),0) FROM expense) AS saldo;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-608,1488],"id":"3fbfbec0-6a51-460c-b481-b46bd4876722","name":"finance_balance_total","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Lista o total de receitas agrupadas por categoria.","operation":"executeQuery","query":"SELECT categoria, SUM(valor) AS total\nFROM income\nGROUP BY categoria\nORDER BY total DESC;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-960,1648],"id":"dbf95eca-2dda-4e01-85e7-090094951e69","name":"finance_income_by_category","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Lista o total de despesas agrupadas por categoria.","operation":"executeQuery","query":"SELECT categoria, SUM(valor) AS total\nFROM expense\nGROUP BY categoria\nORDER BY total DESC;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-800,1648],"id":"d01119a9-d09e-45f1-b667-74317e96dd8c","name":"finance_expense_by_category","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Mostra o total de despesas por forma de pagamento.","operation":"executeQuery","query":"SELECT forma_pagamento, SUM(valor) AS total\nFROM expense\nGROUP BY forma_pagamento;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-624,1648],"id":"ff033482-7497-4064-9f80-332ea9389a81","name":"finance_expense_by_payment_method","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Mostra o total de despesas agrupadas por status (ex: pago, pendente).","operation":"executeQuery","query":"SELECT status, SUM(valor) AS total\nFROM expense\nGROUP BY status;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-448,1488],"id":"9a9e123b-5dcc-4e06-bada-ebab7b64a49e","name":"finance_expense_by_status","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Resume despesas recorrentes versus n√£o recorrentes.","operation":"executeQuery","query":"SELECT recorrente, SUM(valor) AS total\nFROM expense\nGROUP BY recorrente;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-448,1648],"id":"08832167-6839-42b3-a7e0-2dd08e6f2541","name":"finance_expense_recurring_summary","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Calcula o saldo consolidado por conta.","operation":"executeQuery","query":"SELECT conta, SUM(valor) AS total\nFROM (\n  SELECT conta, valor FROM income\n  UNION ALL\n  SELECT conta, -valor FROM expense\n) t\nGROUP BY conta;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-256,1648],"id":"2954198b-6980-4f2a-b420-20256b9868a5","name":"finance_balance_by_account","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna a evolu√ß√£o mensal das receitas.","operation":"executeQuery","query":"SELECT DATE_TRUNC('month', data) AS mes, SUM(valor) AS total\nFROM income\nGROUP BY mes\nORDER BY mes;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-272,1488],"id":"18ce37ba-ec4a-423b-bdb3-d5c242d7f1f9","name":"finance_income_monthly_trend","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna a evolu√ß√£o mensal das despesas.","operation":"executeQuery","query":"SELECT DATE_TRUNC('month', data) AS mes, SUM(valor) AS total\nFROM expense\nGROUP BY mes\nORDER BY mes;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-96,1488],"id":"53c7227a-2e79-434d-b4bb-507cc82683f5","name":"finance_expense_monthly_trend","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna o total de despesas parceladas.","operation":"executeQuery","query":"SELECT SUM(valor) AS total_parcelado\nFROM expense\nWHERE parcelas IS NOT NULL AND parcelas > 1;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-80,1648],"id":"d6bef687-057d-40c2-bd40-0761fdd43e5a","name":"finance_expense_installments_total","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Execute a SQL query in Postgres","operation":"executeQuery","query":"UPDATE financial_account SET saldo_atual = saldo_atual + $2, updated_at = NOW() WHERE id = $1 AND tipo = 'conta';","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}, {{ $fromAI('valor', 'Valor a remover', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-2096,1488],"id":"ae95e020-ee61-4e7a-b1e1-c321b01de3e9","name":"account_add_balance","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Reduz o limite dispon√≠vel do cart√£o ao registrar despesa paga.","operation":"executeQuery","query":"UPDATE financial_account SET limite_disponivel = limite_disponivel - $2, updated_at = NOW() WHERE id = $1 AND tipo = 'cartao';","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}, {{ $fromAI('valor', 'Valor a remover', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1696,1488],"id":"2ebc3c69-a113-4802-a2c3-cbe7bc09288d","name":"credit_card_use_limit","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Devolve limite dispon√≠vel (cancelamento/estorno).","operation":"executeQuery","query":"UPDATE financial_account SET limite_disponivel = limite_disponivel + $2, updated_at = NOW() WHERE id = $1 AND tipo = 'cartao' AND limite_disponivel + $2 <= limite_total;","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}, {{ $fromAI('valor', 'Valor a remover', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-2192,1648],"id":"313866e9-0e4a-413d-8171-06344a3c267b","name":"credit_card_refund_limit","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Restaura o limite dispon√≠vel no fechamento da fatura do cart√£o.","operation":"executeQuery","query":"UPDATE financial_account SET limite_disponivel = limite_total, updated_at = NOW() WHERE tipo = 'cartao' AND fechamento_dia = EXTRACT(DAY FROM CURRENT_DATE);","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-2000,1648],"id":"a7ad99d7-f4bb-436c-888c-cc24214420a6","name":"credit_card_reset_limit","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Consulta o saldo atual dispon√≠vel de uma conta.","operation":"executeQuery","query":"SELECT id, nome, saldo_atual FROM financial_account WHERE id = $1 AND tipo = 'conta' AND ativo = true;","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1792,1648],"id":"b18cce01-5b90-4af3-9d9f-cf4f3e30f3d5","name":"account_get_balance","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Consulta limite total, dispon√≠vel e utilizado do cart√£o.","operation":"executeQuery","query":"SELECT id, nome, limite_total, limite_disponivel, (limite_total - limite_disponivel) AS limite_utilizado FROM financial_account WHERE id = $1 AND tipo = 'cartao' AND ativo = true;","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1616,1648],"id":"194ed87d-df74-4894-b6a6-fb6b41740f1b","name":"credit_card_get_limit","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Lista todos os saldos de contas e limites de cart√µes ativos.","operation":"executeQuery","query":"SELECT id, nome,tipo, saldo_atual, limite_total, limite_disponivel FROM financial_account WHERE ativo = true ORDER BY nome;","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1520,1488],"id":"080194de-af46-4722-9b75-c0721bbaeada","name":"account_card_list_all","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Remove saldo dispon√≠vel de uma conta corrente/d√©bito.","operation":"executeQuery","query":"UPDATE financial_account \nSET saldo_atual = saldo_atual - $2, updated_at = NOW() \nWHERE id = $1 AND tipo = 'conta';\n","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}, {{ $fromAI('valor', 'Valor a remover', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1888,1488],"id":"60a01a08-20b5-4807-ba65-1b25646108df","name":"account_remove_balance","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}}],"connections":{"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_languageModel","index":0}]]},"consultar_expense":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"consultar_income":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"Limit":{"main":[[{"node":"Principal Agent","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"Principal Agent","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Principal Agent","type":"main","index":0}]]},"Analyze image":{"main":[[{"node":"Edit Fields3","type":"main","index":0}]]},"Convert to File2":{"main":[[{"node":"Analyze image","type":"main","index":0}]]},"Obter m dia em base65":{"main":[[{"node":"Convert to File2","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Principal Agent","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"If","type":"main","index":0}]]},"If1":{"main":[[{"node":"Enviar texto1","type":"main","index":0}],[{"node":"Generate audio","type":"main","index":0}]]},"Generate audio":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Enviar audio","type":"main","index":0}]]},"Insert Data to Store":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Obter m dia em base":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"Insert Data to Store","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Insert Data to Store","type":"ai_document","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Insert Data to Store","type":"ai_embedding","index":0},{"node":"Query Data Tool","type":"ai_embedding","index":0}]]},"Convert to File":{"main":[[{"node":"Transcribe a recording","type":"main","index":0}]]},"Obter m dia em base64":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Transcribe a recording":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Obter m dia em base64","type":"main","index":0}],[{"node":"Obter m dia em base65","type":"main","index":0}],[{"node":"Obter m dia em base","type":"main","index":0}],[{"node":"Edit Fields4","type":"main","index":0}]]},"agente_especialista_em_economia_e_financas":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"inserir_expense":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"inserir_income":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"calculadora":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"Postgres Chat Memory1":{"ai_memory":[[{"node":"Principal Agent","type":"ai_memory","index":0}]]},"Query Data Tool":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Principal Agent","type":"ai_languageModel","index":0}]]},"If":{"main":[[{"node":"Switch","type":"main","index":0}],[{"node":"Enviar texto","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Principal Agent":{"main":[[{"node":"If1","type":"main","index":0}]]},"finance_income_total":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_total":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_balance_total":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_by_status":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_income_monthly_trend":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_monthly_trend":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_income_by_category":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_by_category":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_by_payment_method":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_recurring_summary":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_balance_by_account":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_installments_total":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"account_add_balance":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"credit_card_use_limit":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"credit_card_refund_limit":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"credit_card_reset_limit":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"account_get_balance":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"credit_card_get_limit":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"account_card_list_all":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"account_remove_balance":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a835b478-4507-4251-8430-5c85a3500b4b","activeVersionId":"a835b478-4507-4251-8430-5c85a3500b4b","triggerCount":1,"shared":[{"updatedAt":"2025-12-28T16:27:41.757Z","createdAt":"2025-12-28T16:27:41.757Z","role":"workflow:owner","workflowId":"GscaFis0DeavfpNB","projectId":"QzOxscPU2fsVc9gL"}],"activeVersion":{"updatedAt":"2026-01-06T18:15:28.735Z","createdAt":"2026-01-06T18:15:26.994Z","versionId":"a835b478-4507-4251-8430-5c85a3500b4b","workflowId":"GscaFis0DeavfpNB","nodes":[{"parameters":{"toolDescription":"Analisar a sa√∫de financeira do usu√°rio, avaliando receitas, despesas e padr√µes de consumo.\nIdentificar excessos por categoria, gastos fora do padr√£o, riscos ao or√ßamento e oportunidades de economia.\nSugerir a√ß√µes pr√°ticas como cortar gastos, adiar compras, cancelar assinaturas ou ajustar prioridades financeiras.","text":"={{ $fromAI('Prompt__User_Message_', `user message`, 'string') }}","options":{"systemMessage":"Voc√™ √© um **Especialista em Finan√ßas Pessoais e Economia Dom√©stica orientado por dados e regras**.\n\nAtue como um **mentor financeiro anal√≠tico**, avaliando gastos, receitas e decis√µes de compra **exclusivamente com base em m√©tricas obtidas via tools** e nas **regras financeiras ativas** do sistema.\n\nVoc√™ **N√ÉO interage com o usu√°rio**.\nVoc√™ **N√ÉO faz perguntas**.\nVoc√™ **N√ÉO armazena dados**.\nVoc√™ **N√ÉO executa transa√ß√µes**.\nVoc√™ **SEMPRE consome dados via tools existentes**, fornecidas pelo Agente Principal.\n\nSeu retorno √© **somente an√°lise, classifica√ß√£o de risco e recomenda√ß√£o objetiva** ao Agente Principal.\n\n---\n\n## üéØ OBJETIVOS\n\n1. Preservar e evoluir a meta de poupan√ßa.\n2. Permitir consumo saud√°vel sem bloqueio excessivo.\n3. Identificar excessos, riscos e desperd√≠cios com base em m√©tricas.\n4. Apoiar decis√µes de compra de forma racional.\n\n---\n\n## üìä FONTES DE VERDADE (TOOLS AUTORIZADAS)\n\nUtilize exclusivamente as seguintes tools:\n\n* `finance_income_total`\n* `finance_expense_total`\n* `finance_balance_total`\n* `finance_income_by_category`\n* `finance_expense_by_category`\n* `finance_income_monthly_trend`\n* `finance_expense_monthly_trend`\n* `finance_expense_recurring_summary`\n* `finance_expense_installments_total`\n* `finance_balance_by_account`\n\nNunca conclua sem consumir **ao menos uma m√©trica** via tool.\n\n---\n\n## üìê REGRA CENTRAL\n\nCompras s√£o aceit√°veis **apenas se a meta de poupan√ßa ativa for preservada**.\n\n---\n\n## üß† MATRIZ DE DECIS√ÉO PARA COMPRAS\n\nCalcule o impacto como **% da renda mensal m√©dia**:\n\n* üü¢ **APROVADA**\n\n  * Meta preservada\n  * Compra ‚â§ limite de consumo livre\n\n* üü° **CUIDADO**\n\n  * Meta preservada\n  * Compra > consumo livre e ‚â§ limite de aten√ß√£o\n\n* üî¥ **N√ÉO RECOMENDADA**\n\n  * Quebra da meta\n  * OU compra > limite de risco\n\n---\n\n## üìà EVOLU√á√ÉO DA META\n\nSugira aumento da meta apenas se **todas** as condi√ß√µes forem verdadeiras:\n\n* Meta cumprida por N meses consecutivos\n* Saldo positivo cont√≠nuo\n* Parcelamentos sob controle\n\n---\n\n## üîÅ FLUXO OBRIGAT√ìRIO\n\n1. Consumir m√©tricas financeiras via tools\n2. Consumir regras financeiras ativas\n3. Consolidar indicadores-chave\n4. Classificar risco\n5. Emitir parecer t√©cnico\n\n---\n\n## üì§ FORMATO OBRIGAT√ìRIO DE SA√çDA\n\nRetorne **sempre** no seguinte formato:\n\n* **Resumo num√©rico** (3 a 5 m√©tricas relevantes)\n* **Classifica√ß√£o de risco**: üü¢ / üü° / üî¥\n* **Justificativa objetiva** baseada em m√©tricas\n* **Recomenda√ß√£o clara** ao Agente Principal\n\n---\n\n## ‚öñÔ∏è PRIORIDADE DE M√âTRICAS\n\nEm caso de conflito, priorize:\n\n1. Tend√™ncia mensal\n2. Recorr√™ncia\n3. Valor absoluto\n\n---\n\n## üó£Ô∏è TOM\n\n* T√©cnico e direto\n* Baseado em n√∫meros\n* Sem julgamento ou emo√ß√£o\n\n---\n\n## üéØ FOCO FINAL\n\nDecidir com base em dados reais,\npreservando crescimento financeiro\nsem travar o consumo.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-1168,1216],"id":"027fea18-94ec-4280-bf6a-487cd8a2605b","name":"agente_especialista_em_economia_e_financas"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-1184,1360],"id":"cffe2e69-de22-4aeb-9d70-4ae6a18c3a70","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Extraia da mensagem do usu√°rio os dados de UMA transa√ß√£o financeira.\n\nA transa√ß√£o DEVE ser classificada como DESPESA (expense).\nResponda APENAS com um JSON v√°lido conforme o schema.\nN√£o explique, n√£o use markdown, n√£o fa√ßa perguntas.\n\nRegras e valores padr√£o:\n- Use SOMENTE as categorias permitidas abaixo\n- Se n√£o informado, use:\n  - conta: \"itau\"\n  - forma_pagamento: \"debito\"\n  - status: \"pago\"\n  - recorrente: false\n  - parcelas: null\n\nCategorias permitidas:\nMoradia\nAlimenta√ß√£o\nTransporte\nSa√∫de\nEduca√ß√£o\nLazer\nAssinaturas\nCompras\nImpostos / Taxas\nInvestimentos\nOutros\n\nSe um valor n√£o for mencionado, infira pelo contexto.\n","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"expense","mode":"list","cachedResultName":"expense"},"columns":{"mappingMode":"defineBelow","value":{"recorrente":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('recorrente', `recorrencia`, 'boolean') }}","valor":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('valor', `valor da despesa`, 'number') }}","nome":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nome', `nome da despesa`, 'string') }}","categoria":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('categoria', `categoria da despesa`, 'string') }}","data":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('data', `data da despesa`, 'string') }}","forma_pagamento":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('forma_pagamento', `forma de pagamento da despesa`, 'string') }}","conta":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conta', `conta da despesa`, 'string') }}","observacao":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('observacao', `uma observacao, detalhes da despesa`, 'string') }}","created_at":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('created_at', `data atual`, 'string') }}","updated_at":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('updated_at', `data da ultima atualizacao nessa despesa`, 'string') }}","parcelas":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parcelas', `quantidade de parcelas`, 'number') }}","status":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('status', `status da despesa`, 'string') }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nome","displayName":"nome","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"categoria","displayName":"categoria","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"valor","displayName":"valor","required":true,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"data","displayName":"data","required":true,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"forma_pagamento","displayName":"forma_pagamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"conta","displayName":"conta","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"recorrente","displayName":"recorrente","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"parcelas","displayName":"parcelas","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"observacao","displayName":"observacao","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1376,1488],"id":"f53d6667-af2d-4365-94e2-901fb9fee62a","name":"inserir_expense","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Extraia da mensagem do usu√°rio os dados de UMA transa√ß√£o financeira.\n\nA transa√ß√£o DEVE ser classificada como RECEITA (income).\n\nObtenha a hora com a tool.\n\nResponda APENAS com um JSON v√°lido conforme o schema.\nN√£o explique, n√£o use markdown, n√£o fa√ßa perguntas.\n\nRegras e valores padr√£o:\n- Use SOMENTE as categorias permitidas abaixo\n- Se n√£o informado, use:\n  - conta: \"itau\"\n  - recorrente: false\n\nCategorias permitidas:\nSal√°rio\nFreelance / Servi√ßos\nInvestimentos\nReembolsos\nVendas\nIPTV\nOutros\n\nSe um valor n√£o for mencionado, infira pelo contexto.\n","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"income","mode":"list","cachedResultName":"income"},"columns":{"mappingMode":"defineBelow","value":{"recorrente":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('recorrente', `recorrencia`, 'boolean') }}","valor":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('valor', `valor da receita`, 'number') }}","nome":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nome', `nome da receita`, 'string') }}","categoria":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('categoria', `categoria da receita`, 'string') }}","data":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('data', `data da receita`, 'string') }}","conta":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conta', `conta da receita`, 'string') }}","observacao":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('observacao', `uma observacao, detalhes da receita`, 'string') }}","created_at":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('created_at', `data de registro`, 'string') }}","updated_at":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('updated_at', `data da ultima atualizacao nessa receita`, 'string') }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"nome","displayName":"nome","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"categoria","displayName":"categoria","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"valor","displayName":"valor","required":true,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"data","displayName":"data","required":true,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"conta","displayName":"conta","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"recorrente","displayName":"recorrente","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"observacao","displayName":"observacao","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1232,1488],"id":"35b579c9-0d98-4468-b463-94ce4778af31","name":"inserir_income","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Consulta despesas registradas no banco de dados.\n","operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"expense","mode":"list","cachedResultName":"expense"},"returnAll":true,"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1456,1648],"id":"68143da7-7c96-473e-9cdc-a50536f69dca","name":"consultar_expense","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Consulta receitas registradas no banco de dados.\n","operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"income","mode":"list","cachedResultName":"income"},"returnAll":true,"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1296,1648],"id":"3c56e471-7f1d-457e-af4b-2b2dc7a52196","name":"consultar_income","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Obter data atual","options":{"timezone":"America/Sao_Paulo"}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[-1152,1648],"id":"194c7621-c16b-47da-a954-cf7dc2c3e8f1","name":"Date & Time"},{"parameters":{},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-2624,640],"id":"89a9cddd-35d8-4239-89be-b158a14d92a1","name":"Limit"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[-1088,1488],"id":"aeaec223-d757-4b9f-85c9-5e50acf71c0d","name":"calculadora"},{"parameters":{"assignments":{"assignments":[{"id":"8abd7e9b-959d-41dc-9d6b-489c51fb9c31","name":"sessionKey","value":"={{ $('Edit Fields').item.json.sessionKey }}","type":"string"},{"id":"624f712a-7a21-499a-85df-a92d54fdcaa2","name":"pushName","value":"={{ $('Edit Fields').item.json.pushName }}","type":"string"},{"id":"90caaf9c-644e-4de4-98b5-4679765c75ef","name":"userMessage","value":"={{   `Contexto interno: mensagem de TEXTO enviada pelo usu√°rio.\\n\\n` +   (     $json.body?.data?.message?.conversation     || $json.body?.data?.message?.extendedTextMessage?.text     || $json.userMessage     || ''   ) }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3360,992],"id":"aca8795d-a50f-4745-b5d3-02000920185e","name":"Edit Fields4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"4a1c86a7-1cd6-4a66-88f5-3d97fb217fb3","leftValue":"={{ $('Edit Fields').item.json.messageType }}","rightValue":"=audioMessage","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1744,800],"id":"796e4f7e-03d8-48f3-8155-087e4a90b8ee","name":"If1"},{"parameters":{"assignments":{"assignments":[{"id":"49fa5727-4418-4185-909c-300f36703606","name":"=userMessage","value":"={{\n  `Contexto interno: o usu√°rio enviou uma IMAGEM. ` +\n  `O texto abaixo √© a descri√ß√£o/an√°lise autom√°tica da imagem e deve ser tratada como a mensagem do usu√°rio.\\n\\n` +\n  (\n    $json?.[0]?.[0]?.content?.[0]?.text\n    || $json?.[0]?.content?.[0]?.text\n    || $json?.content?.[0]?.text\n    || ''\n  )\n  .replace(/\\n{3,}/g, '\\n\\n')\n  .slice(0, 1200)\n}}","type":"string"},{"id":"cd40549b-b15a-4849-a8e6-e44dd3a48551","name":"pushName","value":"={{ $('Edit Fields').item.json.pushName }}","type":"string"},{"id":"df2c4f04-ecf4-4e80-91db-f306a2a9b058","name":"sessionKey","value":"={{ $('Edit Fields').item.json.sessionKey }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2816,832],"id":"f50928c7-4243-49d3-a0f5-2ef246877e0d","name":"Edit Fields3"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-3104,832],"id":"96d8f1da-35e6-43be-9118-4348890dc6c0","name":"Analyze image","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-3360,832],"id":"29110333-8bec-4589-9ce9-ba7f368ff1f8","name":"Convert to File2"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"={{ $('Webhook').item.json.body.instance }}","messageId":"={{ $('Webhook').item.json.body.data.key.id }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3568,832],"id":"8fbedc7b-ae38-4867-8d6e-f03edfdebd69","name":"Obter m dia em base65","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"assignments":{"assignments":[{"id":"49fa5727-4418-4185-909c-300f36703606","name":"=userMessage","value":"={{ `O usu√°rio enviou um DOCUMENTO e ele j√° foi indexado na base. Arquivo: ${$('Edit Fields').item.json.docFileName || 'sem_nome'} MIME: ${$('Edit Fields').item.json.docMime || 'desconhecido'} Legenda: ${$('Edit Fields').item.json.docCaption || ''}Instru√ß√£o: responda confirmando o recebimento.` }}","type":"string"},{"id":"cd40549b-b15a-4849-a8e6-e44dd3a48551","name":"pushName","value":"={{ $('Edit Fields').item.json.pushName }}","type":"string"},{"id":"df2c4f04-ecf4-4e80-91db-f306a2a9b058","name":"sessionKey","value":"={{ $('Edit Fields').item.json.sessionKey }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2832,640],"id":"4cdcdce1-38ae-438f-9863-8977bd616a94","name":"Edit Fields2"},{"parameters":{"assignments":{"assignments":[{"id":"2edac3ce-6e19-4449-a7fb-e1b703f7a48c","name":"=sessionKey","value":"={{ $('Edit Fields').item.json.sessionKey }}","type":"string"},{"id":"40d54e8a-7762-479c-8435-93a531a06089","name":"=pushName","value":"={{ $node[\"Edit Fields\"].json.pushName }}","type":"string"},{"id":"d72f934a-c7ae-4945-b168-c9f5450dae3e","name":"userMessage","value":"={{\n  `Contexto interno: o usu√°rio enviou um √ÅUDIO. ` +\n  `O conte√∫do abaixo √© a transcri√ß√£o autom√°tica do √°udio e deve ser tratada como a mensagem do usu√°rio.\\n\\n` +\n  `${$json.text || $json.output || ''}`\n}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2832,448],"id":"6233e846-cfad-46cd-b511-f2a921cee303","name":"Edit Fields1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Edit Fields').item.json.sessionKey }}\n"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-2080,992],"id":"a687878c-57dd-4c76-a943-1cc3f06d918e","name":"Postgres Chat Memory1","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"assignments":{"assignments":[{"id":"c4d128b0-d81f-40a1-978e-079d794b9ba0","name":"remoteJid","value":"={{ ($json.body?.data?.key?.remoteJid || \"\").trim() }}\n","type":"string"},{"id":"aa40dfe2-31af-4aa3-aa62-a3d4584311a3","name":"pushName","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"bd177eaf-6bf7-472f-b47b-d37775d3cea0","name":"messageType","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"9e2dd8a3-16da-40f4-9fb1-655ee4af5478","name":"conversation","value":"={{ $json.body.data.message }}","type":"object"},{"id":"b41f2269-5fe9-447b-9804-6acfc73c5274","name":"instance","value":"={{ $json.body.instance }}","type":"string"},{"id":"e2f12b88-2249-4bfd-84e9-5c235df25ec5","name":"messageId","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"938849bc-639a-42ec-ba48-77eb01416b9b","name":"sessionKey","value":"={{ String($json.body?.data?.key?.remoteJid || $json.body?.data?.key?.participant || '').trim() }}","type":"string"},{"id":"7a924aa7-4c86-48f8-b92f-b17d3300b407","name":"userMessage","value":"={{\n  $json.body?.data?.message?.conversation\n  || $json.body?.data?.message?.extendedTextMessage?.text\n  || $json.body?.data?.message?.imageMessage?.caption\n  || $json.body?.data?.message?.documentMessage?.caption\n  || $json.body?.data?.message?.documentMessage?.fileName\n  || '[Documento recebido]'\n}}\n","type":"string"},{"id":"b9891591-61e0-4f98-a18f-655583dfc1c7","name":"docFileName","value":"={{ $json.body?.data?.message?.documentMessage?.fileName || '' }}","type":"string"},{"id":"fefdd292-70fa-46dd-89af-3afade046268","name":"docMime","value":"={{ $json.body?.data?.message?.documentMessage?.mimetype || '' }}","type":"string"},{"id":"5216e3ea-991a-43d6-8199-567b78fa1124","name":"docCaption","value":"={{ $json.body?.data?.message?.documentMessage?.caption || '' }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4464,768],"id":"454e0e5e-7e74-4ea0-ad0b-1f3c5d8fb011","name":"Edit Fields"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1.1,"position":[-1136,896],"id":"a6fa9fc1-426e-45f0-b525-a4bf990295ea","name":"Extract from File"},{"parameters":{"resource":"audio","input":"={{ $json.output }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-1344,896],"id":"ab35df46-9d71-4e8f-a52c-e842d4ba65d9","name":"Generate audio","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"resource":"messages-api","operation":"send-audio","instanceName":"=Servidor","remoteJid":"={{ $node[\"Webhook\"].json[\"body\"][\"data\"][\"key\"][\"remoteJid\"] }}","media":"={{ $json.data }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-864,896],"id":"cc20e92b-6e25-4bb5-bdbb-48417f59e5cf","name":"Enviar audio","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"mode":"insert","memoryKey":{"__rl":true,"value":"knowledge_base","mode":"list","cachedResultName":"knowledge_base"},"embeddingBatchSize":2000,"clearStore":true},"type":"@n8n/n8n-nodes-langchain.vectorStoreInMemory","typeVersion":1.2,"position":[-3104,640],"id":"4260ca52-a84a-472c-8de7-bafa2a01c375","name":"Insert Data to Store"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"={{ $('Webhook').item.json.body.instance }}","messageId":"={{ $('Webhook').item.json.body.data.key.id }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3568,640],"id":"0b0459d8-23de-46b1-81df-204d25913b77","name":"Obter m dia em base","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-3360,640],"id":"5275ea7e-0ddd-4176-8741-544f0687e70c","name":"Convert to File1"},{"parameters":{"mode":"retrieve-as-tool","toolName":"knowledge_base","toolDescription":"Use this knowledge base to answer questions from the user","memoryKey":{"__rl":true,"value":"knowledge_base","mode":"list"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreInMemory","typeVersion":1.2,"position":[-2352,1184],"id":"e24c961c-33b0-4442-a5e5-e28821d279d4","name":"Query Data Tool"},{"parameters":{"dataType":"binary","options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[-2912,1088],"id":"dda2385f-085b-468a-aa1e-1a6b795bb889","name":"Default Data Loader"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-2944,1424],"id":"2c82d30e-46ec-430d-95a2-f54c2025da8f","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-3360,464],"id":"e43fa20d-0656-4fe5-be22-4032a335a406","name":"Convert to File"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"={{ $('Webhook').item.json.body.instance }}","messageId":"={{ $('Webhook').item.json.body.data.key.id }}","convertToMp4":true},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3568,464],"id":"2a0fae25-52a7-4144-8ac6-c11a7cadbe7b","name":"Obter m dia em base64","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-3104,464],"id":"266c7b2f-86a7-4118-9724-260ec34c1dde","name":"Transcribe a recording","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"leftValue":"={{ $json.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"},"id":"bce270e8-87db-4123-a807-05b73ed66bda"}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"b3f3acbe-b7dd-4a17-8e69-64b347704a0f","leftValue":"={{ $json.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"caa5781b-f2be-4731-8e96-7607ceaf007a","leftValue":"={{ $json.messageType }}","rightValue":"documentMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"document"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"1260786f-a7a1-460a-b687-a5a4b916db49","leftValue":"={{ $json.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.4,"position":[-4032,896],"id":"ef551126-ef14-40be-a24d-8d9f554b41d1","name":"Switch"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{"webSearch":{"searchContextSize":"medium"}},"options":{"temperature":0.4}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-2240,1008],"id":"3bd00bdf-d132-4988-b1d5-f188de27b5b1","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Y4tW8JkZbEkWoDHr","name":"PSW OpenAi"}}},{"parameters":{"resource":"messages-api","instanceName":"Servidor","remoteJid":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","messageText":"={{ $json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-1168,656],"id":"55d50a42-3fb3-4803-bca4-f320000f1548","name":"Enviar texto1","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"Servidor","remoteJid":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","messageText":"Voc√™ n√£o tem permiss√£o para user este canal.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-4048,640],"id":"4a094817-808b-428c-afa3-d95030a6ec82","name":"Enviar texto","credentials":{"evolutionApi":{"id":"d28XWDAPREwdYHxH","name":"Evolution account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"a35b27a9-3024-4971-883d-bc7fe60fc1ed","leftValue":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","rightValue":"=120363405178114557@g.us","operator":{"type":"string","operation":"equals"}},{"id":"59bfe806-1da1-4aa0-a96e-e11dee4ed6ee","leftValue":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","rightValue":"120363405178114557@g.us","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-4272,768],"id":"0dca307b-f112-4732-bad9-d60db7339b04","name":"If"},{"parameters":{"httpMethod":"POST","path":"kairo","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-4672,768],"id":"a72308d4-13d5-46e0-9904-6ad9fd16c23d","name":"Webhook","webhookId":"537191fc-0bff-4504-85a7-bc14c63ce9dc"},{"parameters":{"promptType":"define","text":"=Nome do Usu√°rio: {{ $json.pushName }}\nMensagem do usu√°rio: {{ $json.userMessage }}\n","options":{"systemMessage":"=Voc√™ √© o **Consultor Financeiro N8N**, um agente focado em **registrar receitas e despesas com o m√≠nimo de fric√ß√£o poss√≠vel**, garantindo que **saldo de contas e limites de cart√µes sejam sempre atualizados corretamente**.\n\nVoc√™ **controla todo o fluxo de registro**.\n\nVoc√™ **PODE consultar um Agente Especialista em Finan√ßas** apenas para **an√°lise econ√¥mica ou valida√ß√£o de risco**, **sem delegar execu√ß√£o**.\n\n---\n\n## ‚ö†Ô∏è REGRAS CR√çTICAS\n\n* Voc√™ **NUNCA responde em JSON** ao usu√°rio final\n* JSON √© **exclusivo para execu√ß√£o de tools**\n* O usu√°rio recebe **apenas mensagens humanas**\n* Voc√™ **SEMPRE mostra um resumo antes de registrar**\n* Voc√™ **SEMPRE adiciona uma observa√ß√£o**\n* Voc√™ **SEMPRE responde ao agente_especialista_em_economia_e_financas**\n* Voc√™ **SEMPRE garante atualiza√ß√£o de saldo ou limite ap√≥s registro**\n* Sempre que n√£o souber o ID da Conta, consulte usando a tool `account_card_list_all`\n* Sempre que precisar calcular, use a tool `calculadora`\n* Sempre que o saldo de uma conta for atualizado, consulte usando a tool `account_get_balance`\n* Sempre que o limite de cr√©dito for atualizado, consulte usando a tool `account_card_list_all`\n* Sempre que uma despesa for atualizada, consulte usando a tool `consultar_expense`\n* Sempre que uma receita for atualizada, consulte usando a tool `consultar_income`\n* **Antes de qualquer opera√ß√£o, verifique se h√° saldo ou limite dispon√≠vel suficiente.**\n\n  * Se n√£o houver, **aborte a opera√ß√£o e informe o usu√°rio**.\n  * Para conta corrente/d√©bito ‚Üí `saldo_atual` via `account_get_balance`\n  * Para cart√£o de cr√©dito ‚Üí `limite_disponivel` via `account_card_list_all`\n\n---\n\n## üéØ OBJETIVO PRINCIPAL\n\n* Identificar receitas ou despesas\n* Inferir valores e campos padr√£o\n* Fazer **UMA confirma√ß√£o curta**\n* Ap√≥s confirma√ß√£o:\n\n  * Executar **UMA tool de INSERT**\n  * Executar **a tool financeira correspondente** (saldo ou limite)\n\n---\n\n## üí∞ REGRA DE IMPACTO FINANCEIRO (OBRIGAT√ìRIA)\n\nAp√≥s um registro **confirmado**:\n\n### RECEITA\n\n* **Sempre adicionar saldo** na conta vinculada ‚Üí `account_add_balance`\n\n### DESPESA (status = pago)\n\n* Se **conta (d√©bito/dinheiro)** ‚Üí `account_remove_balance`\n* Se **cart√£o de cr√©dito** ‚Üí `credit_card_use_limit`\n\n‚ö†Ô∏è Despesas **n√£o pagas** n√£o alteram saldo nem limite.\n\n---\n\n## üß† USO DO AGENTE ESPECIALISTA\n\nVoc√™ **DEVE consultar o especialista SOMENTE quando**:\n\n* O usu√°rio pedir opini√£o ou valida√ß√£o\n* Houver d√∫vida de risco, excesso ou recorr√™ncia\n* Perguntas como *‚Äúvale a pena?‚Äù*, *‚Äúposso gastar?‚Äù*\n\n‚ö†Ô∏è Nunca consulte apenas para registrar\n‚ö†Ô∏è O especialista **n√£o executa tools**\n\nAp√≥s resposta:\n\n* Traduza o insight em **linguagem simples**\n* Volte ao fluxo normal\n\n---\n\n## üó£Ô∏è REGRAS DE CONVERSA\n\n* Nunca fa√ßa mais de **UMA pergunta**\n* Nunca pe√ßa dados √≥bvios\n* Nunca explique schema, banco ou t√©cnica\n* Se faltar algo obrigat√≥rio, informe **no resumo**\n* Ap√≥s confirma√ß√£o: **execute as tools e n√£o fale mais nada**\n\n---\n\n## ‚öôÔ∏è PADR√ïES (quando ausentes)\n\n* conta: `itau`\n* forma_pagamento: `debito`\n* status (despesa): `pago`\n* recorrente: `false`\n* parcelas: 1\n* data: hoje\n\n---\n\n## üóÇÔ∏è CATEGORIAS PERMITIDAS\n\n**DESPESA**\nMoradia, Alimenta√ß√£o, Transporte, Sa√∫de, Educa√ß√£o,\nLazer, Assinaturas, Compras, Impostos / Taxas,\nInvestimentos, Outros\n\n**RECEITA**\nSal√°rio, Freelance / Servi√ßos, Investimentos,\nReembolsos, Vendas, IPTV, Outros\n\n---\n\n## üîÅ FLUXO OBRIGAT√ìRIO\n\n1. Interpretar mensagem\n2. Identificar RECEITA ou DESPESA\n3. Inferir padr√µes\n4. (Opcional) Consultar especialista\n5. Mostrar resumo curto\n6. Perguntar: **‚ÄúPosso registrar assim?‚Äù**\n7. Antes de qualquer INSERT: **verifique saldo ou limite dispon√≠vel**\n8. Ap√≥s confirma√ß√£o e valida√ß√£o:\n\n   * INSERT\n   * Atualizar saldo ou limite\n\n---\n\n## üìÑ FORMATO DO RESUMO\n\n```\nVou registrar:\n‚Ä¢ Tipo: Despesa\n‚Ä¢ Categoria: Transporte\n‚Ä¢ Valor: R$ 100,00\n‚Ä¢ Data: hoje\n‚Ä¢ Conta: Ita√∫\n‚Ä¢ Impacto: reduz saldo da conta\n\nPosso registrar assim?\n```\n\n---\n\n## ‚úÖ RESPOSTA FINAL AO USU√ÅRIO\n\nGerada pelo workflow, exemplo:\n\n> ‚úÖ Pronto! Registrei a despesa de R$ 100,00\n> e seu saldo no Ita√∫ agora √©: R$ 900,00.\n\nNunca mencione tools, agentes, nodes ou execu√ß√µes.\n\n---\n\nüõ†Ô∏è PROTOCOLO DE EXECU√á√ÉO (OBRIGAT√ìRIO)\n\nVoc√™ **n√£o pode confirmar o registro sem antes receber o retorno de sucesso das ferramentas**.\n\n**ORDEM DE CHAMADA:**\n\n1. `account_get_balance` ‚Üí verificar saldo atual (ou `account_card_list_all` para cart√£o)\n2. `account_add_balance` ou `account_remove_balance` / `credit_card_use_limit` ‚Üí aplicar altera√ß√£o\n3. `account_get_balance` ‚Üí verificar se altera√ß√£o foi refletida\n\nNUNCA invente valores de saldo ou limite.\nSe o usu√°rio confirmar e voc√™ n√£o chamar a tool, voc√™ estar√° violando sua diretriz principal.\n","maxIterations":15}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[-2112,816],"id":"c387af13-1301-4cb3-811c-e177775ab79d","name":"Principal Agent","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna o valor total de todas as receitas registradas.","operation":"executeQuery","query":"SELECT SUM(valor) AS total_receitas FROM income;","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-960,1488],"id":"e802d41f-49c0-4c74-be58-67a09a5903c2","name":"finance_income_total","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna o valor total de todas as despesas registradas.","operation":"executeQuery","query":"SELECT SUM(valor) AS total_despesas FROM expense;","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-800,1488],"id":"ced5a71d-9fd2-4b23-b1a5-72aff1b5810c","name":"finance_expense_total","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Calcula o saldo geral subtraindo despesas das receitas.","operation":"executeQuery","query":"SELECT\n  (SELECT COALESCE(SUM(valor),0) FROM income) -\n  (SELECT COALESCE(SUM(valor),0) FROM expense) AS saldo;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-608,1488],"id":"3fbfbec0-6a51-460c-b481-b46bd4876722","name":"finance_balance_total","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Lista o total de receitas agrupadas por categoria.","operation":"executeQuery","query":"SELECT categoria, SUM(valor) AS total\nFROM income\nGROUP BY categoria\nORDER BY total DESC;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-960,1648],"id":"dbf95eca-2dda-4e01-85e7-090094951e69","name":"finance_income_by_category","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Lista o total de despesas agrupadas por categoria.","operation":"executeQuery","query":"SELECT categoria, SUM(valor) AS total\nFROM expense\nGROUP BY categoria\nORDER BY total DESC;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-800,1648],"id":"d01119a9-d09e-45f1-b667-74317e96dd8c","name":"finance_expense_by_category","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Mostra o total de despesas por forma de pagamento.","operation":"executeQuery","query":"SELECT forma_pagamento, SUM(valor) AS total\nFROM expense\nGROUP BY forma_pagamento;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-624,1648],"id":"ff033482-7497-4064-9f80-332ea9389a81","name":"finance_expense_by_payment_method","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Mostra o total de despesas agrupadas por status (ex: pago, pendente).","operation":"executeQuery","query":"SELECT status, SUM(valor) AS total\nFROM expense\nGROUP BY status;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-448,1488],"id":"9a9e123b-5dcc-4e06-bada-ebab7b64a49e","name":"finance_expense_by_status","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Resume despesas recorrentes versus n√£o recorrentes.","operation":"executeQuery","query":"SELECT recorrente, SUM(valor) AS total\nFROM expense\nGROUP BY recorrente;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-448,1648],"id":"08832167-6839-42b3-a7e0-2dd08e6f2541","name":"finance_expense_recurring_summary","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Calcula o saldo consolidado por conta.","operation":"executeQuery","query":"SELECT conta, SUM(valor) AS total\nFROM (\n  SELECT conta, valor FROM income\n  UNION ALL\n  SELECT conta, -valor FROM expense\n) t\nGROUP BY conta;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-256,1648],"id":"2954198b-6980-4f2a-b420-20256b9868a5","name":"finance_balance_by_account","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna a evolu√ß√£o mensal das receitas.","operation":"executeQuery","query":"SELECT DATE_TRUNC('month', data) AS mes, SUM(valor) AS total\nFROM income\nGROUP BY mes\nORDER BY mes;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-272,1488],"id":"18ce37ba-ec4a-423b-bdb3-d5c242d7f1f9","name":"finance_income_monthly_trend","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna a evolu√ß√£o mensal das despesas.","operation":"executeQuery","query":"SELECT DATE_TRUNC('month', data) AS mes, SUM(valor) AS total\nFROM expense\nGROUP BY mes\nORDER BY mes;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-96,1488],"id":"53c7227a-2e79-434d-b4bb-507cc82683f5","name":"finance_expense_monthly_trend","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Retorna o total de despesas parceladas.","operation":"executeQuery","query":"SELECT SUM(valor) AS total_parcelado\nFROM expense\nWHERE parcelas IS NOT NULL AND parcelas > 1;\n","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-80,1648],"id":"d6bef687-057d-40c2-bd40-0761fdd43e5a","name":"finance_expense_installments_total","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Execute a SQL query in Postgres","operation":"executeQuery","query":"UPDATE financial_account SET saldo_atual = saldo_atual + $2, updated_at = NOW() WHERE id = $1 AND tipo = 'conta';","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}, {{ $fromAI('valor', 'Valor a remover', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-2096,1488],"id":"ae95e020-ee61-4e7a-b1e1-c321b01de3e9","name":"account_add_balance","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Reduz o limite dispon√≠vel do cart√£o ao registrar despesa paga.","operation":"executeQuery","query":"UPDATE financial_account SET limite_disponivel = limite_disponivel - $2, updated_at = NOW() WHERE id = $1 AND tipo = 'cartao';","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}, {{ $fromAI('valor', 'Valor a remover', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1696,1488],"id":"2ebc3c69-a113-4802-a2c3-cbe7bc09288d","name":"credit_card_use_limit","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Devolve limite dispon√≠vel (cancelamento/estorno).","operation":"executeQuery","query":"UPDATE financial_account SET limite_disponivel = limite_disponivel + $2, updated_at = NOW() WHERE id = $1 AND tipo = 'cartao' AND limite_disponivel + $2 <= limite_total;","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}, {{ $fromAI('valor', 'Valor a remover', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-2192,1648],"id":"313866e9-0e4a-413d-8171-06344a3c267b","name":"credit_card_refund_limit","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Restaura o limite dispon√≠vel no fechamento da fatura do cart√£o.","operation":"executeQuery","query":"UPDATE financial_account SET limite_disponivel = limite_total, updated_at = NOW() WHERE tipo = 'cartao' AND fechamento_dia = EXTRACT(DAY FROM CURRENT_DATE);","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-2000,1648],"id":"a7ad99d7-f4bb-436c-888c-cc24214420a6","name":"credit_card_reset_limit","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Consulta o saldo atual dispon√≠vel de uma conta.","operation":"executeQuery","query":"SELECT id, nome, saldo_atual FROM financial_account WHERE id = $1 AND tipo = 'conta' AND ativo = true;","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1792,1648],"id":"b18cce01-5b90-4af3-9d9f-cf4f3e30f3d5","name":"account_get_balance","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Consulta limite total, dispon√≠vel e utilizado do cart√£o.","operation":"executeQuery","query":"SELECT id, nome, limite_total, limite_disponivel, (limite_total - limite_disponivel) AS limite_utilizado FROM financial_account WHERE id = $1 AND tipo = 'cartao' AND ativo = true;","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1616,1648],"id":"194ed87d-df74-4894-b6a6-fb6b41740f1b","name":"credit_card_get_limit","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Lista todos os saldos de contas e limites de cart√µes ativos.","operation":"executeQuery","query":"SELECT id, nome,tipo, saldo_atual, limite_total, limite_disponivel FROM financial_account WHERE ativo = true ORDER BY nome;","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1520,1488],"id":"080194de-af46-4722-9b75-c0721bbaeada","name":"account_card_list_all","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Remove saldo dispon√≠vel de uma conta corrente/d√©bito.","operation":"executeQuery","query":"UPDATE financial_account \nSET saldo_atual = saldo_atual - $2, updated_at = NOW() \nWHERE id = $1 AND tipo = 'conta';\n","options":{"queryReplacement":"={{ $fromAI('account_id', 'ID da conta', 'number') }}, {{ $fromAI('valor', 'Valor a remover', 'number') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-1888,1488],"id":"60a01a08-20b5-4807-ba65-1b25646108df","name":"account_remove_balance","credentials":{"postgres":{"id":"iZzbVy2qVYG0Rd5z","name":"Postgres account"}}}],"connections":{"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_languageModel","index":0}]]},"consultar_expense":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"consultar_income":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"Limit":{"main":[[{"node":"Principal Agent","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"Principal Agent","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Principal Agent","type":"main","index":0}]]},"Analyze image":{"main":[[{"node":"Edit Fields3","type":"main","index":0}]]},"Convert to File2":{"main":[[{"node":"Analyze image","type":"main","index":0}]]},"Obter m dia em base65":{"main":[[{"node":"Convert to File2","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Principal Agent","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"If","type":"main","index":0}]]},"If1":{"main":[[{"node":"Enviar texto1","type":"main","index":0}],[{"node":"Generate audio","type":"main","index":0}]]},"Generate audio":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Enviar audio","type":"main","index":0}]]},"Insert Data to Store":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Obter m dia em base":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"Insert Data to Store","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Insert Data to Store","type":"ai_document","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Insert Data to Store","type":"ai_embedding","index":0},{"node":"Query Data Tool","type":"ai_embedding","index":0}]]},"Convert to File":{"main":[[{"node":"Transcribe a recording","type":"main","index":0}]]},"Obter m dia em base64":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Transcribe a recording":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Obter m dia em base64","type":"main","index":0}],[{"node":"Obter m dia em base65","type":"main","index":0}],[{"node":"Obter m dia em base","type":"main","index":0}],[{"node":"Edit Fields4","type":"main","index":0}]]},"agente_especialista_em_economia_e_financas":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"inserir_expense":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"inserir_income":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"calculadora":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"Postgres Chat Memory1":{"ai_memory":[[{"node":"Principal Agent","type":"ai_memory","index":0}]]},"Query Data Tool":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Principal Agent","type":"ai_languageModel","index":0}]]},"If":{"main":[[{"node":"Switch","type":"main","index":0}],[{"node":"Enviar texto","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Principal Agent":{"main":[[{"node":"If1","type":"main","index":0}]]},"finance_income_total":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_total":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_balance_total":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_by_status":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_income_monthly_trend":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_monthly_trend":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_income_by_category":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_by_category":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_by_payment_method":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_recurring_summary":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_balance_by_account":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"finance_expense_installments_total":{"ai_tool":[[{"node":"agente_especialista_em_economia_e_financas","type":"ai_tool","index":0}]]},"account_add_balance":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"credit_card_use_limit":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"credit_card_refund_limit":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"credit_card_reset_limit":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"account_get_balance":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"credit_card_get_limit":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"account_card_list_all":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]},"account_remove_balance":{"ai_tool":[[{"node":"Principal Agent","type":"ai_tool","index":0}]]}},"authors":"CAIO ASSUNCAO","name":"Version a835b478","description":"","autosaved":false},"tags":[{"updatedAt":"2025-12-28T16:26:50.362Z","createdAt":"2025-12-28T16:26:50.362Z","id":"I1XEUT2DBgIBJaKj","name":"Caio Henrique"}],"error":"Your request is invalid or could not be processed by the service"}